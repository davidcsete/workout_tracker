<div class="max-w-4xl mx-auto mt-10 p-6">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold">Your Nutrition Goals</h1>
    <div class="flex gap-2">
      <%= link_to "Edit Goals", edit_diet_goal_path(@diet_goal), class: "btn btn-primary" %>
      <%= link_to "Regenerate", regenerate_diet_goal_path(@diet_goal), method: :patch, 
                  class: "btn btn-outline", 
                  data: { confirm: "This will recalculate your goals based on your current profile. Continue?" } %>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Daily Calories Card -->
    <div class="card bg-base-200 shadow-xl">
      <div class="card-body">
        <h2 class="card-title text-primary">Daily Calories</h2>
        <div class="text-4xl font-bold text-center py-4">
          <%= @diet_goal.daily_calories %> <span class="text-lg font-normal">kcal</span>
        </div>
        <div class="text-center text-sm opacity-70">
          Target: <%= @diet_goal.weight_change_per_week > 0 ? "+" : "" %><%= @diet_goal.weight_change_per_week %> kg/week
        </div>
      </div>
    </div>

    <!-- Goal Type Card -->
    <div class="card bg-base-200 shadow-xl">
      <div class="card-body">
        <h2 class="card-title text-secondary">Goal Type</h2>
        <div class="text-center py-4">
          <div class="badge badge-lg <%= @diet_goal.is_custom? ? 'badge-accent' : 'badge-primary' %> mb-2">
            <%= @diet_goal.is_custom? ? 'Custom' : 'Auto-Generated' %>
          </div>
          <div class="text-sm opacity-70">
            Based on: <%= current_user.user_detail.goal.name %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Macros Breakdown -->
  <div class="card bg-base-200 shadow-xl mt-6">
    <div class="card-body">
      <h2 class="card-title text-accent mb-4">Macro Breakdown</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Protein -->
        <div class="text-center">
          <div class="text-2xl font-bold text-red-500"><%= @diet_goal.protein_grams %>g</div>
          <div class="text-sm opacity-70">Protein</div>
          <div class="text-xs opacity-50"><%= @diet_goal.protein_percentage %>% of calories</div>
          <progress class="progress progress-error w-full mt-2" value="<%= @diet_goal.protein_percentage %>" max="100"></progress>
          <div class="text-xs mt-1 opacity-60">
            <%= (@diet_goal.protein_grams * 4).round %> calories
          </div>
        </div>

        <!-- Carbs -->
        <div class="text-center">
          <div class="text-2xl font-bold text-blue-500"><%= @diet_goal.carb_grams %>g</div>
          <div class="text-sm opacity-70">Carbohydrates</div>
          <div class="text-xs opacity-50"><%= @diet_goal.carb_percentage %>% of calories</div>
          <progress class="progress progress-info w-full mt-2" value="<%= @diet_goal.carb_percentage %>" max="100"></progress>
          <div class="text-xs mt-1 opacity-60">
            <%= (@diet_goal.carb_grams * 4).round %> calories
          </div>
        </div>

        <!-- Fat -->
        <div class="text-center">
          <div class="text-2xl font-bold text-yellow-500"><%= @diet_goal.fat_grams %>g</div>
          <div class="text-sm opacity-70">Fat</div>
          <div class="text-xs opacity-50"><%= @diet_goal.fat_percentage %>% of calories</div>
          <progress class="progress progress-warning w-full mt-2" value="<%= @diet_goal.fat_percentage %>" max="100"></progress>
          <div class="text-xs mt-1 opacity-60">
            <%= (@diet_goal.fat_grams * 9).round %> calories
          </div>
        </div>
      </div>

      <!-- Macro Distribution Pie Chart Visualization -->
      <div class="mt-6">
        <h3 class="text-lg font-semibold mb-3 text-center">Visual Distribution</h3>
        <div class="flex justify-center">
          <div class="radial-progress bg-base-300 text-primary border-4 border-primary" 
               style="--value:<%= @diet_goal.protein_percentage %>; --size:8rem; --thickness: 1rem;" 
               role="progressbar">
            <div class="radial-progress bg-transparent text-info border-4 border-info" 
                 style="--value:<%= @diet_goal.carb_percentage %>; --size:6rem; --thickness: 1rem;" 
                 role="progressbar">
              <div class="radial-progress bg-transparent text-warning border-4 border-warning" 
                   style="--value:<%= @diet_goal.fat_percentage %>; --size:4rem; --thickness: 1rem;" 
                   role="progressbar">
                <span class="text-xs font-bold">Macros</span>
              </div>
            </div>
          </div>
        </div>
        <div class="flex justify-center gap-4 mt-3 text-xs">
          <div class="flex items-center gap-1">
            <div class="w-3 h-3 bg-primary rounded"></div>
            <span>Protein</span>
          </div>
          <div class="flex items-center gap-1">
            <div class="w-3 h-3 bg-info rounded"></div>
            <span>Carbs</span>
          </div>
          <div class="flex items-center gap-1">
            <div class="w-3 h-3 bg-warning rounded"></div>
            <span>Fat</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const inputs = ['food-grams', 'food-protein', 'food-carbs', 'food-fat'];
      const result = document.getElementById('calc-result');
      
      function calculateMacros() {
        const grams = parseFloat(document.getElementById('food-grams').value) || 0;
        const proteinPct = parseFloat(document.getElementById('food-protein').value) || 0;
        const carbsPct = parseFloat(document.getElementById('food-carbs').value) || 0;
        const fatPct = parseFloat(document.getElementById('food-fat').value) || 0;
        
        if (grams > 0 && (proteinPct > 0 || carbsPct > 0 || fatPct > 0)) {
          const proteinG = (grams * proteinPct / 100).toFixed(1);
          const carbsG = (grams * carbsPct / 100).toFixed(1);
          const fatG = (grams * fatPct / 100).toFixed(1);
          const calories = (proteinG * 4 + carbsG * 4 + fatG * 9).toFixed(0);
          
          result.innerHTML = `
            <strong>${calories} calories:</strong> 
            ${proteinG}g protein, ${carbsG}g carbs, ${fatG}g fat
          `;
        } else {
          result.innerHTML = 'Enter values to see macro breakdown';
        }
      }
      
      inputs.forEach(id => {
        document.getElementById(id).addEventListener('input', calculateMacros);
      });
    });
  </script>
</div>
